# Vehicle Fleet Configuration for Segarloka
# Priority: Blind Van -> City Car -> Mobil -> Motor (minimize total vehicles)
# Ordered by cost (highest to lowest) to minimize vehicle count

vehicles:
  # Highest priority: Blind Van (most expensive, largest capacity)
  - name: "Blind Van"
    capacity: 800 # kg
    cost_per_km: 10000 # Rupiah per kilometer (HIGHEST)
    fixed_count: 1 # Only 1 unit available

  # Second priority: City Car (high cost, good capacity)
  - name: "City Car 350kg"
    capacity: 350 # kg
    cost_per_km: 6000 # Rupiah per kilometer
    fixed_count: 2 # 2 units available

  # Third priority: Mobil (medium cost, medium capacity)
  - name: "City Car 250kg"
    capacity: 250 # kg
    cost_per_km: 4000 # Rupiah per kilometer
    fixed_count: 1 # Only 1 unit available

  # Last priority: Sepeda Motor (cheapest, smallest capacity, unlimited on-demand)
  - name: "Sepeda Motor"
    capacity: 80 # kg
    cost_per_km: 1500 # Rupiah per kilometer (LOWEST)
    fixed_count: 50 # 15 base units
    unlimited: false # Can add more on demand

# Routing configuration
routing:
  return_to_depot: true # Set to false if vehicles can end anywhere
  priority_time_tolerance: 0 # Priority orders must be within time window (in minutes)
  non_priority_time_tolerance: 60 # Non-priority can be late up to 60 minutes (1 hour)
  multiple_trips: true # Allow vehicles to do multiple trips per day
  relax_time_windows: false # if true, solver will relax time window constraint
  time_window_relaxation_minutes: 15 # minutes to relax time window

# Solver Constraints (for debugging and flexibility)
constraints:
  enforce_time_windows: true # Toggle time window constraints on/off
  enforce_capacity: true # Toggle vehicle capacity constraints on/off
  enforce_city_limit: true # Toggle 2-city-per-vehicle limit on/off
  allow_dropped_orders: true # Allow orders to be unassigned if constraints too tight

# Penalty values for constraint violations
penalties:
  dropped_order: 1000000 # High penalty for unassigned orders (default: 1000000)
  time_violation_per_minute: 100 # Penalty per minute if time windows are soft (default: 100)

# Debug mode configuration
debug:
  enabled: false # Enable debug logging and file outputs
  log_level: "INFO" # Log level: DEBUG, INFO, WARNING, ERROR
  save_distance_matrix: false # Save distance matrix to CSV for inspection
  save_solver_params: false # Save solver parameters to file

# OR-Tools Solver Performance Configuration
solver:
  # Time limits (in seconds)
  time_limit: 300 # Total solver time limit (default: 300s = 5 minutes)

  # Optimization strategy: "minimize_vehicles", "minimize_cost", "balanced"
  optimization_strategy: "balanced"

  # Local search metaheuristic settings
  metaheuristic: "GUIDED_LOCAL_SEARCH" # GUIDED_LOCAL_SEARCH, TABU_SEARCH, SIMULATED_ANNEALING
  guided_local_search:
    lambda_coefficient_minimize_vehicles: 0.1 # Penalty coefficient for vehicle minimization
    lambda_coefficient_minimize_cost: 0.2 # Penalty coefficient for cost optimization
    lambda_coefficient_balanced: 0.15 # Penalty coefficient for balanced approach

  # Advanced performance settings
  solution_limit: 50000 # Maximum number of solutions to explore
  lns_time_limit: 1 # Large Neighborhood Search time limit per iteration (seconds)
  use_depth_first_search: false # Use best-first search instead of depth-first

# Multi-Hub configuration for two-tier delivery routing
# Supports 0 to N hubs. Set enabled: false or remove all locations for zero-hub mode.
hubs:
  enabled: true # Enable hub-based routing (false = all orders direct from DEPOT)

  # Hub definitions (0 to N hubs)
  # Each hub has its own zone assignments and blind van mode
  locations:
    - id: "hub_utara"
      name: "Hub Utara"
      latitude: -6.164667483144517
      longitude: 106.87160878270096
      address: "Kedung Kesenian"
      zones_via_hub:
        - "JAKARTA UTARA"
        - "JAKARTA BARAT"
        - "TANGERANG"
        - "BEKASI UTARA"
      # Per-hub blind van configuration
      # mode: "consolidation_only" (Mode A) or "consolidation_with_delivery" (Mode B)
      blind_van:
        mode: "consolidation_only" # Mode A: only consolidation, no delivery

    # Example: Hub with Mode B (consolidation + en-route delivery)
    # - id: "hub_selatan"
    #   name: "Hub Selatan"
    #   latitude: -6.280000
    #   longitude: 106.830000
    #   address: "Jakarta Selatan"
    #   zones_via_hub:
    #     - "JAKARTA SELATAN"
    #     - "DEPOK"
    #     - "BOGOR"
    #   blind_van:
    #     mode: "consolidation_with_delivery"  # Mode B
    #     en_route_delivery:
    #       max_stops: 3           # Max delivery stops before reaching hub
    #       max_detour_minutes: 10 # Max time deviation from direct route
    #       max_detour_km: 5.0     # Max distance deviation from direct route
    #       reserve_capacity_kg: 100  # Reserved capacity for hub consolidation

  # Blind Van schedule for hub consolidation
  blind_van_schedule:
    departure_time: "05:30" # Depart from DEPOT
    hub_arrival_deadline: "06:00" # Must arrive at hubs by this time (HARD constraint)
    vehicle_name: "Blind Van" # Which vehicle type for consolidation
    return_to_depot: false # Set to false if blind van can end at last hub

  # Motor routing settings
  motor_routing:
    can_depart_from_depot: true # Motors can start from main depot
    can_depart_from_hub: true # Motors can start from hubs
    start_delivery_after: "06:00" # Motors start after Blind Van completes

  # How to handle orders from zones not assigned to any hub
  # "nearest" = assign to geographically nearest hub
  # "depot" = route directly from depot (no hub)
  unassigned_zone_behavior: "nearest"

  # Source assignment strategy
  # "zone_based" = assign based on zone config only (current behavior)
  # "dynamic" = assign based on cost comparison (distance + time)
  # "hybrid" = dynamic with zone-based fallback
  source_assignment:
    mode: "hybrid"
    dynamic:
      min_cost_advantage_percent: 10 # Switch source only if 10% better
      weights:
        distance: 1.0 # Weight for distance cost
        time: 0.5 # Weight for travel time cost

# Cache configuration for Radar API (cost optimization)
cache:
  enabled: false # Enable/disable distance matrix caching
  ttl_hours: 72 # Cache time-to-live in hours (default: 24)
  directory: ".cache" # Directory for cache files
